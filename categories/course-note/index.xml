<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Course-Note on diefish&#39;s blog</title>
    <link>https://diefish1024.github.io/categories/course-note/</link>
    <description>Recent content in Course-Note on diefish&#39;s blog</description>
    <image>
      <title>diefish&#39;s blog</title>
      <url>https://diefish1024.github.io/images/avatar.jpg</url>
      <link>https://diefish1024.github.io/images/avatar.jpg</link>
    </image>
    <generator>Hugo -- 0.149.0</generator>
    <language>zh-cn</language>
    <lastBuildDate>Wed, 06 Aug 2025 23:35:00 +0800</lastBuildDate>
    <atom:link href="https://diefish1024.github.io/categories/course-note/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>22. æ–‡ä»¶ç³»ç»Ÿ API</title>
      <link>https://diefish1024.github.io/posts/nju-os-2025/22-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-api/</link>
      <pubDate>Wed, 06 Aug 2025 23:35:00 +0800</pubDate>
      <guid>https://diefish1024.github.io/posts/nju-os-2025/22-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-api/</guid>
      <description>&lt;h2 id=&#34;ç›®å½•æ ‘&#34;&gt;ç›®å½•æ ‘&lt;/h2&gt;
&lt;h3 id=&#34;æ–‡ä»¶çš„æŠ½è±¡&#34;&gt;æ–‡ä»¶çš„æŠ½è±¡&lt;/h3&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿå°†ç‰©ç†å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚ç£ç›˜ï¼‰çš„å¤æ‚æ€§éšè—èµ·æ¥ï¼Œæä¾›äº†ä¸€ä¸ªç®€å•ã€ç»Ÿä¸€çš„æŠ½è±¡â€”â€”&lt;strong&gt;æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ª&lt;strong&gt;è™šæ‹Ÿçš„ç£ç›˜&lt;/strong&gt;ï¼Œå³ä¸€ä¸ªå‘½åçš„ã€ä¸€ç»´çš„&lt;strong&gt;å­—èŠ‚åºåˆ—&lt;/strong&gt;ï¼Œæ”¯æŒ &lt;code&gt;read&lt;/code&gt;, &lt;code&gt;write&lt;/code&gt;, &lt;code&gt;lseek&lt;/code&gt; ç­‰æ“ä½œ&lt;/p&gt;
&lt;p&gt;è¿™ç§æŠ½è±¡ä½¿å¾—ä¸Šå±‚åº”ç”¨æ— éœ€å…³å¿ƒæ•°æ®åœ¨ç‰©ç†ç£ç›˜ä¸Šçš„å…·ä½“ä½ç½®å’Œå­˜å‚¨æ–¹å¼&lt;/p&gt;
&lt;h3 id=&#34;ç›®å½•çš„å¼•å…¥&#34;&gt;ç›®å½•çš„å¼•å…¥&lt;/h3&gt;
&lt;p&gt;å½“æ–‡ä»¶æ•°é‡å¢å¤šæ—¶ï¼Œéœ€è¦ä¸€ç§æ–¹å¼æ¥ç»„ç»‡å’Œç®¡ç†å®ƒä»¬&lt;/p&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿå¼•å…¥äº†&lt;strong&gt;ç›®å½• (Directory)&lt;/strong&gt; çš„æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå…¶å†…å®¹æ˜¯å…¶ä»–æ–‡ä»¶æˆ–ç›®å½•çš„åˆ—è¡¨&lt;/p&gt;
&lt;p&gt;é€šè¿‡å°†æ–‡ä»¶å’Œç›®å½•ç»„ç»‡æˆä¸€ä¸ªå±‚æ¬¡åŒ–çš„&lt;strong&gt;æ ‘çŠ¶ç»“æ„&lt;/strong&gt;ï¼Œå³&lt;strong&gt;ç›®å½•æ ‘&lt;/strong&gt;ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¯¹æ–‡ä»¶è¿›è¡Œåˆ†ç±»ã€æŸ¥æ‰¾å’Œç®¡ç†&lt;/p&gt;
&lt;p&gt;å¤šæ•°ç±» Unix ç³»ç»Ÿéµå¾ª &lt;strong&gt;FHS (Filesystem Hierarchy Standard)&lt;/strong&gt; çš„ç›®å½•ç»“æ„çº¦å®šï¼Œä¸ºè½¯ä»¶å’Œç”¨æˆ·é¢„æµ‹æ–‡ä»¶ä½ç½®æä¾›äº†ä¾¿åˆ©&lt;/p&gt;
&lt;h3 id=&#34;ç›®å½•æ“ä½œ-api&#34;&gt;ç›®å½•æ“ä½œ API&lt;/h3&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ç³»åˆ—ç³»ç»Ÿè°ƒç”¨æ¥æ“ä½œç›®å½•æ ‘ï¼Œæ ¸å¿ƒæ“ä½œå›´ç»•â€œå¢åˆ æ”¹æŸ¥â€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;mkdir&lt;/code&gt;: åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rmdir&lt;/code&gt;: åˆ é™¤ä¸€ä¸ªç©ºçš„ç›®å½•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;getdents&lt;/code&gt;: è¯»å–ç›®å½•ä¸­çš„æ¡ç›® (&lt;strong&gt;d&lt;/strong&gt;irectory &lt;strong&gt;ent&lt;/strong&gt;rie&lt;strong&gt;s&lt;/strong&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;link&lt;/code&gt; / &lt;code&gt;unlink&lt;/code&gt;: åˆ›å»ºæˆ–åˆ é™¤æ–‡ä»¶çš„é“¾æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;é“¾æ¥&#34;&gt;é“¾æ¥&lt;/h3&gt;
&lt;p&gt;é“¾æ¥æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå®ƒå…è®¸ä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªåå­—æˆ–å­˜åœ¨äºç›®å½•æ ‘çš„å¤šä¸ªä½ç½®&lt;/p&gt;
&lt;p&gt;é“¾æ¥ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š&lt;strong&gt;ç¡¬é“¾æ¥&lt;/strong&gt;å’Œ&lt;strong&gt;è½¯é“¾æ¥ï¼ˆç¬¦å·é“¾æ¥ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&#34;ç¡¬é“¾æ¥-hard-link&#34;&gt;ç¡¬é“¾æ¥ Hard Link&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼š&lt;strong&gt;ç¡¬é“¾æ¥&lt;/strong&gt;æ˜¯è®©å¤šä¸ªç›®å½•æ¡ç›®ï¼ˆæ–‡ä»¶åï¼‰ç›´æ¥æŒ‡å‘ç£ç›˜ä¸ŠåŒä¸€ä¸ª&lt;strong&gt;æ–‡ä»¶ç´¢å¼•èŠ‚ç‚¹ (inode)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæ–‡ä»¶åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ &lt;code&gt;inode&lt;/code&gt;ï¼Œå®ƒåŒ…å«äº†æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆå¦‚æƒé™ã€å¤§å°ã€æ•°æ®å—ä½ç½®ç­‰ï¼‰å’Œæ•°æ®æœ¬èº«&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªç¡¬é“¾æ¥ï¼Œç›¸å½“äºä¸ºåŒä¸€ä¸ª &lt;code&gt;inode&lt;/code&gt; å¢åŠ äº†ä¸€ä¸ªæ–°çš„å…¥å£ç‚¹ï¼ˆæ–‡ä»¶åï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰æŒ‡å‘åŒä¸€ä¸ª &lt;code&gt;inode&lt;/code&gt; çš„ç¡¬é“¾æ¥åœ°ä½å¹³ç­‰ï¼Œæ²¡æœ‰ä¸»æ¬¡ä¹‹åˆ†&lt;/li&gt;
&lt;li&gt;&lt;code&gt;inode&lt;/code&gt; å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª&lt;strong&gt;é“¾æ¥è®¡æ•° (reference count)&lt;/strong&gt;, åªæœ‰å½“è¿™ä¸ªè®¡æ•°å‡åˆ° 0 æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿæ‰ä¼šçœŸæ­£åˆ é™¤è¯¥ &lt;code&gt;inode&lt;/code&gt; å’Œå¯¹åº”çš„æ•°æ®å—ï¼Œè¿™ä¹Ÿæ˜¯ &lt;code&gt;unlink&lt;/code&gt; ç³»ç»Ÿè°ƒç”¨çš„ç”±æ¥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é™åˆ¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸èƒ½ä¸ºç›®å½•åˆ›å»ºç¡¬é“¾æ¥ï¼Œä»¥é˜²æ­¢åœ¨ç›®å½•æ ‘ä¸­äº§ç”Ÿå¾ªç¯&lt;/li&gt;
&lt;li&gt;ä¸èƒ½è·¨è¶Šä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå› ä¸º &lt;code&gt;inode&lt;/code&gt; å·åªåœ¨å½“å‰æ–‡ä»¶ç³»ç»Ÿå†…å”¯ä¸€ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;è½¯é“¾æ¥-symbolic-link&#34;&gt;è½¯é“¾æ¥ Symbolic Link&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼š&lt;strong&gt;è½¯é“¾æ¥&lt;/strong&gt;ï¼Œä¹Ÿç§°&lt;strong&gt;ç¬¦å·é“¾æ¥ (symlink)&lt;/strong&gt;ï¼Œæ˜¯ä¸€ä¸ª&lt;strong&gt;ç‰¹æ®Šçš„æ–‡ä»¶&lt;/strong&gt;ï¼Œå®ƒçš„å†…å®¹æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„&lt;strong&gt;è·¯å¾„&lt;/strong&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>21. å­˜å‚¨è®¾å¤‡åŸç†</title>
      <link>https://diefish1024.github.io/posts/nju-os-2025/21-%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E5%8E%9F%E7%90%86/</link>
      <pubDate>Mon, 04 Aug 2025 11:41:00 +0800</pubDate>
      <guid>https://diefish1024.github.io/posts/nju-os-2025/21-%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E5%8E%9F%E7%90%86/</guid>
      <description>&lt;p&gt;ç§‘æ™®æ€§è´¨ï¼Œç®€å•è®°å½•ä¸€ä¸‹&lt;/p&gt;
&lt;h2 id=&#34;1-bit-çš„å­˜å‚¨ç£é“&#34;&gt;1-Bit çš„å­˜å‚¨ï¼šç£é“&lt;/h2&gt;
&lt;p&gt;è¦å®ç°â€œæŒä¹…åŒ–â€å­˜å‚¨ï¼Œæ ¸å¿ƒæ˜¯è¦æ‰¾åˆ°ä¸€ä¸ªèƒ½åå¤æ”¹å†™çš„çŠ¶æ€ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°èƒ½å¤Ÿåˆ©ç”¨ç£çš„ç‰¹æ€§ï¼Œè¿™å°±æœ‰äº†ç£å¸¦çš„åˆæ­¥æƒ³æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªé•¿æ¡çš„å¸¦å­ä¸Šé¢å‡åŒ€æœ‰ç£æ€§ç‰©è´¨&lt;/li&gt;
&lt;li&gt;å®šä½åˆ°ç‰¹å®šä½ç½®ä¹‹åé€šè¿‡æ”¾å¤§æ„Ÿåº”ç”µæµè¯»å–&lt;/li&gt;
&lt;li&gt;ç”¨ç”µç£é“æ”¹å˜ç£åŒ–æ–¹å‘æ¥å†™å…¥æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†æé«˜å­˜å‚¨å¯†åº¦ï¼Œå¯ä»¥æŠŠè¿™æ ·çš„å¸¦å­ç»™å·èµ·æ¥ï¼Œäºæ˜¯å°±å¾—åˆ°äº†ç£å¸¦&lt;/p&gt;
&lt;p&gt;è¿™æ ·çš„å­˜å‚¨æ–¹å¼ä¸»è¦ç¼ºç‚¹æ˜¯&lt;strong&gt;å‡ ä¹ä¸èƒ½éšæœºè¯»å†™&lt;/strong&gt;ï¼ˆæ¯”å¦‚ç£å¸¦æ”¶éŸ³æœºéœ€è¦å€’å¸¦ï¼‰ï¼Œä¸€èˆ¬ç”¨äºå†·æ•°æ®çš„å­˜æ¡£å’Œå¤‡ä»½&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªç¼ºç‚¹ï¼Œå¯ä»¥æƒ³åˆ°ç”¨æ—‹è½¬çš„äºŒç»´å¹³é¢æ¥æ›¿ä»£å·èµ·æ¥çš„å¸¦å­ï¼Œè¿™æ ·è¯»å†™å»¶è¿Ÿå°±ä¸ä¼šè¶…è¿‡æ—‹è½¬çš„å‘¨æœŸï¼Œè¿™å°±å¾—åˆ°äº†&lt;strong&gt;ç£é¼“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://diefish1024.github.io/images/21-%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E5%8E%9F%E7%90%86/pasted-image-20250805012735-png&#34;&gt;&lt;/p&gt;
&lt;p&gt;å†åœ¨ç£é¼“çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥å†…å·ï¼ŒæŠŠç”¨åœ†ç›˜ä»£æ›¿æŸ±é¢ï¼Œä»è€Œå¯ä»¥å †å èµ·æ¥ï¼Œè¿›ä¸€æ­¥æé«˜äº†å­˜å‚¨å¯†åº¦ï¼Œè¿™å°±å¾—åˆ°äº†&lt;strong&gt;ç£ç›˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img loading=&#34;lazy&#34; src=&#34;https://diefish1024.github.io/images/21-%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E5%8E%9F%E7%90%86/pasted-image-20250805012958-png&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç£ç›˜ä½œä¸ºå­˜å‚¨è®¾å¤‡çš„éšæœºè¯»å†™æ€§èƒ½è™½ç„¶ç›¸æ¯”ç£å¸¦æœ‰äº†å¾ˆå¤§çš„æ”¹å–„ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦ç­‰å¾…å®šä½åˆ°æ­£ç¡®çš„ä½ç½®ï¼Œæ€§èƒ½ä»ç„¶ä¸å¤Ÿä¼˜ç§€ï¼Œä¸ºäº†è¯»å†™å®šä½åˆ°ä¸€ä¸ªæ‰‡åŒºé€šå¸¸éœ€è¦èŠ±è´¹å‡ ä¸ªæ¯«ç§’çš„æ—¶é—´ï¼Œè¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡ç¼“å­˜å’Œè°ƒåº¦ç®—æ³•æ¥ç¼“è§£ï¼Œè®©æ•°æ®å°½å¯èƒ½è¿ç»­å­˜å‚¨&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬åœ¨ç£ç›˜çš„åŸºç¡€ä¸ŠæŠŠè¯»å†™å¤´å’Œç›˜ç‰‡æœ¬ä½“åˆ†å¼€ï¼Œæˆ‘ä»¬å°±å®ç°äº†æ•°æ®çš„ç§»åŠ¨ï¼Œè¿™ä¹Ÿå°±å¾—åˆ°äº†&lt;strong&gt;è½¯ç›˜&lt;/strong&gt;ï¼Œè¿™æ˜¯ä¸Šä¸ªæ•°æ®æ•°æ®å‘è¡Œçš„ä¸»è¦æ–¹å¼ï¼Œè™½ç„¶æ€§èƒ½å’Œå¯é æ€§éƒ½æ¯”è¾ƒä½ï¼Œä½†æ˜¯èƒœåœ¨äº†ä¾¿æ·ã€å¯ç§»åŠ¨&lt;/p&gt;
&lt;h2 id=&#34;1-bit-çš„å­˜å‚¨æŒ–å‘&#34;&gt;1-Bit çš„å­˜å‚¨ï¼šæŒ–å‘&lt;/h2&gt;
&lt;p&gt;å¤äººå®ç°æŒä¹…åŒ–å­˜å‚¨çš„æ–¹å¼æ˜¯åœ¨çŸ³å¤´ä¸Šåˆ»å­—ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡æŒ–å‘æ¥å­˜å‚¨ä¿¡æ¯ï¼Œè¿™ç§æ–¹å¼å¯ä»¥è·¨è¶Šéå¸¸é•¿çš„æ—¶é—´&lt;/p&gt;
&lt;p&gt;è€Œç°ä»£å·¥ä¸šä½¿æˆ‘ä»¬å¯ä»¥æŒ–å‡ºæ›´åŠ ç²¾ç»†çš„å‘ï¼Œä»è€Œå¯ä»¥å­˜å‚¨æ›´é«˜å¯†åº¦çš„ä¿¡æ¯&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è¯»å–è¿™æ ·çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»å…‰å­¦çš„è§’åº¦è€ƒè™‘ï¼šåœ¨åå°„å¹³é¢ä¸ŠæŒ–ç²—ç³™å‘ï¼Œæ¿€å…‰æ‰«è¿‡è¡¨é¢ï¼Œåœ¨å¹³é¢ä¼šåå°„å›æ¥ï¼Œåœ¨å‘é‡Œä¼šå‘ç”Ÿæ¼«åå°„ï¼Œäºæ˜¯æˆ‘ä»¬åªè¦æ£€æµ‹æ˜¯å¦æ”¶åˆ°åå°„å…‰å°±å¯ä»¥è¯†åˆ«æ˜¯å‘è¿˜æ˜¯è¡¨é¢ï¼Œè¿™ä¹Ÿå°±æ˜¯&lt;strong&gt;å…‰ç›˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…‰ç›˜æœ€æœ‰è¶£çš„ç‰¹æ€§æ˜¯å®¹æ˜“å¤åˆ¶ï¼Œæˆ‘ä»¬è¦åˆ¶é€ å…‰ç›˜å¯ä»¥å…ˆä»”ç»†åœ°åˆ¶é€ ä¸€å¼ åè½¬çš„ç›˜ç‰‡ï¼Œå‘çš„ä½ç½®å¯¹åº”å…¶è¡¨é¢çš„çªèµ·ï¼Œä¹‹ååªéœ€è¦ç›´æ¥ç”¨è¿™ä¸ªç›˜ç‰‡å‹åˆ¶åŠ çƒ­çš„å¡‘æ–™å†é•€ä¸Šåå°„è†œå°±å¯ä»¥å¾—åˆ°ä¸€å¼ å…‰ç›˜ï¼Œè¿™ç§æ–¹å¼å¯ä»¥è¾¾åˆ°æé«˜çš„å†™å…¥é€Ÿåº¦&lt;/p&gt;
&lt;p&gt;å½“ç„¶è¿™ç§æŒ–å‘æ–¹å¼çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§å°±æ˜¯ä¸èƒ½ä¿®æ”¹å·²ç»å†™å…¥çš„å†…å®¹çš„ï¼Œå¾ˆéš¾å¡«ä¸Šä¸€ä¸ªå·²ç»æŒ–äº†çš„å‘ï¼ˆå½“ç„¶é€šè¿‡ç‰¹æ®Šçš„åˆ¶é€ ææ–™å’Œå·¥è‰ºä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ï¼‰ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´é‡Œé¢å­˜å‚¨çš„æ•°æ®æ˜¯ append only çš„ï¼Œæƒ³è¦ä¿®æ”¹ä¹‹å‰çš„å†…å®¹å¯ä»¥é‡‡ç”¨å¯æŒä¹…åŒ–äºŒå‰æ ‘çš„ç»“æ„&lt;/p&gt;
&lt;p&gt;å…‰ç›˜ä½œä¸ºå­˜å‚¨è®¾å¤‡ï¼Œä»·æ ¼ä½çš„åŒæ—¶å®¹é‡å’Œå¯é æ€§éƒ½æ¯”è¾ƒé«˜ï¼ŒåŒæ—¶é¡ºåºè¯»æ€§èƒ½ä¸€èˆ¬ï¼Œéšæœºè¯»æ€§èƒ½ä½å¹¶ä¸”å¾ˆéš¾å†™å…¥ï¼Œä¸€ä¸ªé‡è¦çš„åº”ç”¨å¸¸è§å°±æ˜¯æ•°å­—æ—¶ä»£çš„å†…å®¹åˆ†å‘&lt;/p&gt;
&lt;p&gt;ç°ä»£è¿™ç§æŒ–å‘çš„å­˜å‚¨æ–¹å¼è¿˜æœ‰ä¸€ç§åº”ç”¨æ–¹å¼æ˜¯å›å½’å¤äººçŸ³ç¢‘çš„å½¢å¼ï¼ŒæŠŠä¿¡æ¯åˆ»åœ¨å¾ˆç¨³å®šçš„ææ–™ä¸Šæ¥åšåˆ°æ°¸ä¹…å­˜å‚¨&lt;/p&gt;
&lt;h2 id=&#34;1-bit-çš„å­˜å‚¨ç”µè·&#34;&gt;1-Bit çš„å­˜å‚¨ï¼šç”µè·&lt;/h2&gt;
&lt;p&gt;å‰ä¸¤ç§å­˜å‚¨ä»‹è´¨éƒ½å­˜åœ¨æ¯”è¾ƒå¤§çš„ç¼ºé™·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç£ï¼šä¾èµ–æœºæ¢°éƒ¨ä»¶ï¼Œä»è€Œæ— æ³•é¿å… ms çº§åˆ«çš„å»¶è¿Ÿ&lt;/li&gt;
&lt;li&gt;å‘ï¼ˆå…‰ï¼‰ï¼šæŒ–å‘æ•ˆç‡ä½ï¼ŒåŒæ—¶å¡«å‘å¾ˆå›°éš¾&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œç”µè·åˆ™æ˜¯ä¸€ç§éå¸¸ç†æƒ³çš„å­˜å‚¨ä»‹è´¨ï¼šç”µå­çš„å¯†åº¦æé«˜ï¼Œå¹¶ä¸”ç”µè·¯çš„é€Ÿåº¦æå¿«ï¼ˆè¿˜å¤©ç„¶å¹¶è¡Œï¼‰&lt;/p&gt;
&lt;p&gt;åœ¨ç”µè·¯ä¸­å®ç° 1-bit çš„æŒä¹…å­˜å‚¨ï¼Œä¸€ä¸ªæƒ³æ³•æ˜¯æˆ‘ä»¬å¯ä»¥æŒ–ä¸€ä¸ªå‘ï¼Œä¸¤ç§çŠ¶æ€åˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å‘é‡Œå¡«å…¥ç”µå­&lt;/li&gt;
&lt;li&gt;ä»å‘é‡Œæ”¾è·‘ç”µå­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è€Œè¿™å°±å¾—åˆ°äº†&lt;strong&gt;é—ªå­˜ (Flash Memory)&lt;/strong&gt; ï¼š
&lt;img loading=&#34;lazy&#34; src=&#34;https://diefish1024.github.io/images/21-%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E5%8E%9F%E7%90%86/pasted-image-20250805112704-png&#34;&gt;
å…¶ä½œä¸ºå­˜å‚¨è®¾å¤‡ï¼Œä»·æ ¼ä½ï¼Œå®¹é‡å’Œå¯é æ€§é«˜ï¼Œè€Œä¸”è¯»å†™æ€§èƒ½æé«˜ï¼ˆç”±äºç”µè·¯å¤©ç„¶å¹¶è¡Œï¼Œæ‰€ä»¥å®¹é‡è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šå¿«ï¼‰&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œé—ªå­˜çš„ç‰©ç†åŸç†ä¹Ÿå¸¦æ¥äº†å…¶å›ºæœ‰çš„ç¼ºé™·ï¼Œå³&lt;strong&gt;ä¼šç£¨æŸ (wear out)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡æ”¾ç”µ (erase) æ“ä½œéƒ½æ— æ³• 100% å°†ç”µå­æ”¾å¹²å‡€ï¼Œè¿™ä¼šå¯¹å­˜å‚¨å•å…ƒé€ æˆå¾®å°çš„ã€ä¸å¯é€†çš„æŸä¼¤&lt;/li&gt;
&lt;li&gt;åœ¨ç»å†æ•°åƒæˆ–æ•°ä¸‡æ¬¡æ“¦å†™å¾ªç¯åï¼Œä¸€äº›å­˜å‚¨å•å…ƒä¼šå› ä¸ºç´¯ç§¯çš„æŸä¼¤è€Œå¤±æ•ˆï¼Œæ— æ³•å†å¯é åœ°å­˜å‚¨æ•°æ®ï¼Œè¿™è¢«ç§°ä¸º â€œ&lt;strong&gt;æ­»å•å…ƒ (Dead Cell)&lt;/strong&gt;â€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†è§£å†³é—ªå­˜çš„ç£¨æŸé—®é¢˜ï¼Œå¹¶å°†å…¶æ›´å¥½åœ°å‘ˆç°ç»™æ“ä½œç³»ç»Ÿï¼Œç°ä»£å›ºæ€å­˜å‚¨è®¾å¤‡ï¼ˆå¦‚ SSDã€U ç›˜ã€SD å¡ï¼‰å†…éƒ¨å®é™…ä¸Šéƒ½é›†æˆäº†ä¸€ä¸ªå¾®å‹è®¡ç®—æœºç³»ç»Ÿ&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç³»ç»Ÿè¿è¡Œç€ä¸€å±‚è¢«ç§°ä¸º &lt;strong&gt;FTL (Flash Translation Layer)&lt;/strong&gt; çš„å›ºä»¶ï¼Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€æ˜¯ &lt;strong&gt;ç£¨æŸå‡è¡¡ (Wear Leveling)&lt;/strong&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>20. è®¾å¤‡å’Œé©±åŠ¨ç¨‹åº</title>
      <link>https://diefish1024.github.io/posts/nju-os-2025/20-%E8%AE%BE%E5%A4%87%E5%92%8C%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/</link>
      <pubDate>Sun, 03 Aug 2025 16:54:00 +0800</pubDate>
      <guid>https://diefish1024.github.io/posts/nju-os-2025/20-%E8%AE%BE%E5%A4%87%E5%92%8C%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F/</guid>
      <description>&lt;h2 id=&#34;è¾“å…¥è¾“å‡ºè®¾å¤‡&#34;&gt;è¾“å…¥è¾“å‡ºè®¾å¤‡&lt;/h2&gt;
&lt;h3 id=&#34;everything-is-a-file&#34;&gt;Everything is a File&lt;/h3&gt;
&lt;p&gt;åœ¨ Unix-like ç³»ç»Ÿä¸­ï¼Œä¸å¤–éƒ¨è®¾å¤‡äº¤äº’çš„æ ¸å¿ƒæ€æƒ³æ˜¯ &lt;strong&gt;Everything is a File&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–‡ä»¶æè¿°ç¬¦ (File Descriptor)&lt;/strong&gt;ï¼šæ“ä½œç³»ç»Ÿä¸ºä¸Šå±‚è½¯ä»¶æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æŠ½è±¡ï¼Œå³æ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘å†…æ ¸ä¸­ä»»ä½• I/O å¯¹è±¡çš„â€œæŒ‡é’ˆâ€æˆ–å¥æŸ„&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»Ÿä¸€æ¥å£&lt;/strong&gt;ï¼šæ— è®ºæ˜¯æ™®é€šæ–‡ä»¶ã€ç¡¬ä»¶è®¾å¤‡ï¼ˆå¦‚ç»ˆç«¯ã€ç£ç›˜ï¼‰ã€è¿˜æ˜¯ç½‘ç»œè¿æ¥ï¼Œéƒ½å¯ä»¥é€šè¿‡ &lt;code&gt;open&lt;/code&gt; è·å¾—ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åä½¿ç”¨ç›¸åŒçš„ &lt;code&gt;read&lt;/code&gt;/&lt;code&gt;write&lt;/code&gt; ç­‰ç³»ç»Ÿè°ƒç”¨æ¥è¿›è¡Œæ“ä½œï¼Œè¿™æå¤§åœ°ç®€åŒ–äº†åº”ç”¨ç¨‹åºçš„ç¼–å†™&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;è®¾å¤‡æ§åˆ¶å™¨ä¸-mmio&#34;&gt;è®¾å¤‡æ§åˆ¶å™¨ä¸ MMIO&lt;/h3&gt;
&lt;p&gt;â€œæ–‡ä»¶â€è¿™ä¸ªç¾å¥½çš„æŠ½è±¡èƒŒåï¼Œæ˜¯å…·ä½“çš„ç¡¬ä»¶å·¥ä½œåŸç†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¾å¤‡æ§åˆ¶å™¨ (Device Controller)&lt;/strong&gt;ï¼šæ¯ä¸ª I/O è®¾å¤‡éƒ½æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å« CPUã€å†…å­˜å’Œå¯„å­˜å™¨çš„å¾®å‹è®¡ç®—æœºï¼Œä½œä¸º CPU å’Œç‰©ç†è®¾å¤‡ä¹‹é—´çš„æ¡¥æ¢&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¾å¤‡å¯„å­˜å™¨&lt;/strong&gt;ï¼šæ§åˆ¶å™¨é€šè¿‡ä¸€ç»„&lt;strong&gt;å¯„å­˜å™¨&lt;/strong&gt;ä¸ CPU é€šä¿¡ï¼Œé€šå¸¸åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çŠ¶æ€å¯„å­˜å™¨&lt;/strong&gt;ï¼šç”¨äºè¡¨ç¤ºè®¾å¤‡å½“å‰æ˜¯å¦ç¹å¿™ã€æ˜¯å¦å‡†å¤‡å¥½ç­‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŒ‡ä»¤å¯„å­˜å™¨&lt;/strong&gt;ï¼šCPU å†™å…¥æŒ‡ä»¤ï¼Œå‘Šè¯‰è®¾å¤‡è¦åšä»€ä¹ˆ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å¯„å­˜å™¨&lt;/strong&gt;ï¼šç”¨äºåœ¨ CPU å’Œè®¾å¤‡ä¹‹é—´ä¼ è¾“æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å†…å­˜æ˜ å°„ I/O (MMIO)&lt;/strong&gt;ï¼šä¸ºäº†è®© CPU èƒ½è®¿é—®è¿™äº›å¯„å­˜å™¨ï¼Œç°ä»£ç³»ç»Ÿæ™®éé‡‡ç”¨ &lt;strong&gt;MMIO (Memory-Mapped I/O)&lt;/strong&gt;ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è®¾å¤‡çš„å¯„å­˜å™¨æ˜ å°„åˆ°ç‰©ç†å†…å­˜åœ°å€ç©ºé—´ä¸­çš„ç‰¹å®šåŒºåŸŸï¼Œè¿™æ ·ä¸€æ¥ï¼ŒCPU å°±å¯ä»¥åƒè®¿é—®æ™®é€šå†…å­˜ä¸€æ ·ï¼Œä½¿ç”¨æ ‡å‡†çš„ &lt;code&gt;load&lt;/code&gt;/&lt;code&gt;store&lt;/code&gt; æŒ‡ä»¤æ¥è¯»å†™è®¾å¤‡å¯„å­˜å™¨ï¼Œä»è€Œå®ç°å¯¹è®¾å¤‡çš„æ§åˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;gpio&#34;&gt;GPIO&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;GPIO (General-Purpose Input/Output)&lt;/strong&gt; æ˜¯ç†è§£ I/O è®¾å¤‡åŸç†æœ€ç›´è§‚çš„ä¾‹å­ï¼ŒGPIO å°±æ˜¯ä¸€ä¸ªç‰©ç†å¼•è„šï¼Œå¯ä»¥é€šè¿‡ç¼–ç¨‹è®¾ç½®ä¸ºè¾“å…¥æˆ–è¾“å‡ºæ¨¡å¼&lt;/p&gt;
&lt;p&gt;é€šè¿‡ MMIOï¼Œä¸€ä¸ª GPIO å¼•è„šçš„ç”µå¹³çŠ¶æ€è¢«æ˜ å°„åˆ°ä¸€ä¸ªç‰¹å®šçš„å†…å­˜åœ°å€ï¼Œå½“ CPU å‘è¿™ä¸ªåœ°å€å†™å…¥ &lt;code&gt;1&lt;/code&gt; æ—¶ï¼Œå¼•è„šå°±å˜ä¸ºé«˜ç”µå¹³ï¼›å†™å…¥ &lt;code&gt;0&lt;/code&gt; æ—¶ï¼Œåˆ™å˜ä¸ºä½ç”µå¹³ï¼Œè¿™ä¸ªè¿‡ç¨‹å°†ä¸€æ¡å†…å­˜å†™æŒ‡ä»¤ç›´æ¥è½¬åŒ–ä¸ºäº†ä¸€ä¸ªç‰©ç†ä¸–ç•Œçš„åŠ¨ä½œï¼ˆæ¯”å¦‚ç‚¹äº®ä¸€ä¸ª LEDï¼‰&lt;/p&gt;</description>
    </item>
    <item>
      <title>19. çœŸå®ä¸–ç•Œçš„å¹¶å‘ç¼–ç¨‹ (2)</title>
      <link>https://diefish1024.github.io/posts/nju-os-2025/19-%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-2/</link>
      <pubDate>Sat, 02 Aug 2025 22:51:00 +0800</pubDate>
      <guid>https://diefish1024.github.io/posts/nju-os-2025/19-%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-2/</guid>
      <description>&lt;h2 id=&#34;cpu-å†…çš„å¹¶è¡Œç¼–ç¨‹&#34;&gt;CPU å†…çš„å¹¶è¡Œç¼–ç¨‹&lt;/h2&gt;
&lt;p&gt;CPU çš„åŠŸè€— $ P=C\cdot V^{2}\cdot f $ å¯¼è‡´çºµä½¿æœ‰æ›´å¤§çš„ç”µè·¯ï¼Œçƒ­åŠŸè€—é™åˆ¶äº†æ€§èƒ½ä¸Šé™ï¼Œä»è€Œæœ‰ä¸€å µâ€œåŠŸè€—å¢™â€é™åˆ¶äº† CPU çš„æ€§èƒ½ï¼Œä¸ºæ­¤éœ€è¦è€ƒè™‘å¦‚ä½•åœ¨é™ä½ $ V $ å’Œ $ f $ çš„åŒæ—¶ç”¨é¢ç§¯æ¢æ€§èƒ½&lt;/p&gt;
&lt;p&gt;æœ‰ä¸¤ä¸ªæ€è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®©ä¸€æ¡æŒ‡ä»¤èƒ½å¤„ç†æ›´å¤šçš„æ•°æ®&lt;/strong&gt;ï¼šSIMD (Single Instruction, Multiple Data)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;â€œä¸€æ¡æŒ‡ä»¤â€ æµªè´¹çš„èƒ½é‡å¤§è‡´æ˜¯å®šæ•°&lt;/li&gt;
&lt;li&gt;å¤„ç†çš„æ•°æ®è¶Šå¤šï¼Œæµªè´¹è¶Šå°‘&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç”¨æ›´å¤šæ›´ç®€å•çš„å¤„ç†å™¨&lt;/strong&gt;ï¼šå¤šå¤„ç†å™¨ç³»ç»Ÿã€å¼‚æ„å¤šå¤„ç†å™¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŒç­‰é¢ç§¯ï¼Œå¤„ç†å™¨è¶Šç®€å•ï¼Œæ•°é‡è¶Šå¤š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ„è®¡ç®—&lt;/strong&gt;ï¼šæœ€ç»å…¸çš„ä¾‹å­æ˜¯&lt;strong&gt;å¤§å°æ ¸æ¶æ„&lt;/strong&gt;ï¼ˆå¦‚ Apple M1ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;simd&#34;&gt;SIMD&lt;/h3&gt;
&lt;p&gt;SIMD çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ç¡¬ä»¶å±‚é¢å®ç°æ•°æ®çº§å¹¶è¡Œï¼Œå®ƒé€šè¿‡å¼•å…¥ä¸“é—¨çš„ç¡¬ä»¶å•å…ƒæ¥è¾¾æˆè¿™ä¸ªç›®æ ‡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®½ä½å¯„å­˜å™¨ (Wide Registers)&lt;/strong&gt;ï¼šCPU å†…éƒ¨å¢åŠ äº†æ¯”é€šç”¨å¯„å­˜å™¨å®½å¾ˆå¤šçš„ä¸“ç”¨å¯„å­˜å™¨&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Intel çš„ SSE æŒ‡ä»¤é›†å¼•å…¥äº† 128 ä½çš„ XMM å¯„å­˜å™¨ï¼Œè€Œæœ€æ–°çš„ AVX-512 æ‹¥æœ‰ 512 ä½çš„ ZMM å¯„å­˜å™¨&lt;/li&gt;
&lt;li&gt;è¿™äº›å®½ä½å¯„å­˜å™¨å¯ä»¥ä¸€æ¬¡æ€§è£…å…¥å¤šä¸ªæ•°æ®å…ƒç´ ï¼Œæ¯”å¦‚ä¸€ä¸ª 128 ä½çš„å¯„å­˜å™¨å¯ä»¥åŒæ—¶å®¹çº³ 4 ä¸ª 32 ä½çš„æµ®ç‚¹æ•°ï¼Œæˆ–è€… 16 ä¸ª 8 ä½çš„æ•´æ•°&lt;/li&gt;
&lt;li&gt;è¿™äº›è¢«æ‰“åŒ…åœ¨ä¸€èµ·çš„æ•°æ®è¢«ç§°ä¸º Vector&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å‘é‡å¤„ç†å•å…ƒ (Vector ALU)&lt;/strong&gt;ï¼šCPU å†…éƒ¨ä¹Ÿé…å¤‡äº†èƒ½å¤Ÿå¯¹æ•´ä¸ªå‘é‡è¿›è¡Œå¹¶è¡Œè®¡ç®—çš„ ALU&lt;/p&gt;</description>
    </item>
    <item>
      <title>18. çœŸå®ä¸–ç•Œçš„å¹¶å‘ç¼–ç¨‹ (1)</title>
      <link>https://diefish1024.github.io/posts/nju-os-2025/18-%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-1/</link>
      <pubDate>Thu, 31 Jul 2025 19:36:00 +0800</pubDate>
      <guid>https://diefish1024.github.io/posts/nju-os-2025/18-%E7%9C%9F%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B-1/</guid>
      <description>&lt;p&gt;å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒæŠ½è±¡æ˜¯å®ç°ä¸€ä¸ªè®¡ç®—å›¾ï¼Œè®¡ç®—å‘ç”Ÿåœ¨èŠ‚ç‚¹ä¸Šï¼Œè¾¹è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶è®¡ç®—å›¾åœ¨è¿è¡Œæ—¶å¯èƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ¡ä»¶å˜é‡ã€é”ã€ä¿¡å·é‡ç­‰ api å»å®ç°è®¡ç®—å›¾å¹¶ä¸æ˜¯ä¸€ä¸ªä¼˜é›…çš„å®ç°æ–¹å¼ï¼Œå› ä¸ºè¿™æ ·ä¼šåœ¨ä»£ç ä¸­å¼•å…¥ä¼—å¤š&lt;strong&gt;å¹²æ‰°ä»£ç &lt;/strong&gt;ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ä¸€äº›é—®é¢˜&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤å¯ä»¥å¢åŠ ä¸€äº›åŠŸèƒ½å—é™çš„&lt;strong&gt;è¯­æ³•&lt;/strong&gt;ï¼Œå¯ä»¥åœ¨åŒæ ·æè¿°è®¡ç®—å›¾çš„åŠŸèƒ½ä¸‹å‡å°‘äº†è®¸å¤šæ½œåœ¨çš„é—®é¢˜&lt;/p&gt;
&lt;h2 id=&#34;é«˜æ€§èƒ½è®¡ç®—ä¸­çš„å¹¶è¡Œç¼–ç¨‹&#34;&gt;é«˜æ€§èƒ½è®¡ç®—ä¸­çš„å¹¶è¡Œç¼–ç¨‹&lt;/h2&gt;
&lt;p&gt;åœ¨é«˜æ€§èƒ½è®¡ç®—ä¸­ï¼Œè®¡ç®—å›¾é€šå¸¸æ˜“äº&lt;strong&gt;é™æ€åˆ‡åˆ†&lt;/strong&gt;ï¼Œå°¤å…¶é€‚ç”¨äºç‰©ç†æ¨¡æ‹Ÿçš„ç½‘æ ¼åˆ’åˆ†ï¼Œä¸ºæ­¤ HPC å‘å±•å‡ºå¤šç§é«˜æ•ˆçš„å¹¶è¡Œç¼–ç¨‹æ¨¡å‹ï¼Œå…·ä½“å­¦ä¹ å¯ä»¥å‚è€ƒ &lt;a href=&#34;https://xflops.sjtu.edu.cn/hpc-start-guide/parallel-computing/basic/&#34;&gt;SJTU HPC å­¦ä¹ æ‰‹å†Œ&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;mpi-åˆ†å¸ƒå¼å†…å­˜å¹¶è¡Œ&#34;&gt;MPI: åˆ†å¸ƒå¼å†…å­˜å¹¶è¡Œ&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ª MPI è¿›ç¨‹æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œè¿›ç¨‹é—´é€šè¿‡&lt;strong&gt;æ˜¾å¼æ¶ˆæ¯ä¼ é€’&lt;/strong&gt;ï¼ˆå‘é€/æ¥æ”¶ï¼‰äº¤æ¢æ•°æ®&lt;/p&gt;
&lt;h4 id=&#34;openmp-å…±äº«å†…å­˜å¹¶è¡Œ&#34;&gt;OpenMP: å…±äº«å†…å­˜å¹¶è¡Œ&lt;/h4&gt;
&lt;p&gt;å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€åœ°å€ç©ºé—´ä¸­å¹¶è¡Œæ‰§è¡Œï¼Œæ‰€æœ‰çº¿ç¨‹å¯ä»¥ç›´æ¥è®¿é—®ç›¸åŒçš„æ•°æ®ï¼Œä½¿ç”¨Â &lt;code&gt;#pragma omp&lt;/code&gt;Â æŒ‡ä»¤å®ç°å¹¶è¡ŒåŒ–&lt;/p&gt;
&lt;p&gt;å¯¹éè®¡ç®—æœºä¸“ä¸šæ¥è¯´éå¸¸å‹å¥½ï¼Œåªéœ€è¦åœ¨æ­£å¸¸çš„ä»£ç ä¸Šé¢åŠ ä¸Šç¼–è¯‘æŒ‡ä»¤å³å¯ï¼Œèƒ½è½»æ¾å®ç°é«˜æ•ˆçš„å¹¶è¡Œä¼˜åŒ–&lt;/p&gt;
&lt;h4 id=&#34;cuda-gpu-å¼‚æ„å¹¶è¡Œ&#34;&gt;CUDA: GPU å¼‚æ„å¹¶è¡Œ&lt;/h4&gt;
&lt;p&gt;CPU è°ƒåº¦ï¼ŒGPU æ‰§è¡Œå¤§è§„æ¨¡å¹¶è¡Œè®¡ç®—&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¦‚å¿µ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ ¸å‡½æ•° (Kernel)&lt;/strong&gt; ï¼šåœ¨ GPU ä¸Šå¹¶è¡Œæ‰§è¡Œçš„å‡½æ•°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çº¿ç¨‹å±‚æ¬¡&lt;/strong&gt;ï¼šçº¿ç¨‹ (&lt;code&gt;threadIdx&lt;/code&gt;) ç»„æˆçº¿ç¨‹å— (&lt;code&gt;blockIdx&lt;/code&gt;)ï¼Œçº¿ç¨‹å—ç»„æˆç½‘æ ¼ (&lt;code&gt;gridDim&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜å±‚æ¬¡&lt;/strong&gt;ï¼šå¯„å­˜å™¨ã€å…±äº«å†…å­˜ï¼ˆå—å†…é«˜é€Ÿï¼‰ã€å…¨å±€å†…å­˜ï¼ˆæ‰€æœ‰çº¿ç¨‹å¯è®¿é—®ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æˆ‘ä»¬èº«è¾¹çš„å¹¶å‘ç¼–ç¨‹&#34;&gt;æˆ‘ä»¬èº«è¾¹çš„å¹¶å‘ç¼–ç¨‹&lt;/h2&gt;
&lt;h4 id=&#34;ä»-web-10-åˆ°-web-20&#34;&gt;ä» Web 1.0 åˆ° Web 2.0&lt;/h4&gt;
&lt;p&gt;åœ¨ Web æ—¶ä»£ç”¨çš„æœ€å¹¿æ³›çš„æ˜¯ Javascript&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Asynchronous JavaScript and XML&lt;/strong&gt; (Ajax; ~1999)
&lt;ul&gt;
&lt;li&gt;å…è®¸ç½‘é¡µå®ç°â€œåå°åˆ·æ–°â€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;jQuery $ (2006): A DOM Query Language&lt;/strong&gt; (ç¼–ç¨‹æŠ½è±¡)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;web-20-æ—¶ä»£çš„å¹¶å‘ç¼–ç¨‹&#34;&gt;Web 2.0 æ—¶ä»£çš„å¹¶å‘ç¼–ç¨‹&lt;/h4&gt;
&lt;p&gt;çº¿ç¨‹å¼€é”€å¤§ï¼Œå¹¶ä¸”å¤§å¤šæ•° Web å¼€å‘è€…éš¾ä»¥è¿›è¡Œå¹¶å‘ç¼–ç¨‹&lt;/p&gt;</description>
    </item>
    <item>
      <title>17. å¹¶å‘ Bugs</title>
      <link>https://diefish1024.github.io/posts/nju-os-2025/17-%E5%B9%B6%E5%8F%91-bugs/</link>
      <pubDate>Thu, 31 Jul 2025 12:12:00 +0800</pubDate>
      <guid>https://diefish1024.github.io/posts/nju-os-2025/17-%E5%B9%B6%E5%8F%91-bugs/</guid>
      <description>&lt;h2 id=&#34;æ•°æ®ç«äº‰&#34;&gt;æ•°æ®ç«äº‰&lt;/h2&gt;
&lt;p&gt;å¤§å¤šå¹¶å‘ bug æœ€åéƒ½ä¼šä½“ç°ä¸º&lt;strong&gt;æ•°æ®ç«äº‰ (Data Race)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºé¡ºåºç¨‹åºè€Œè¨€ï¼Œå‡½æ•° &lt;code&gt;f()&lt;/code&gt; è¿”å›ä¹‹åå°±å·²ç»å®Œæˆäº†æ‰€æœ‰çš„çŠ¶æ€ä¿®æ”¹ï¼Œå¯¹äºå…¶ä»–éƒ¨åˆ†è€Œè¨€è¿™ä¸ªä¿®æ”¹æ˜¯ç«‹å³ç”Ÿæ•ˆçš„ï¼›å¦‚æœå¯¹äºå¹¶å‘ç¨‹åºè€Œè¨€æ¨¡å¼çš„åˆ‡æ¢ä¹Ÿåœ¨ç¬é—´å®Œæˆï¼Œé‚£å°±ä¸ä¼šå¯¼è‡´å¹¶å‘çš„é—®é¢˜&lt;/p&gt;
&lt;p&gt;ç„¶è€Œå®é™…ä¸Šæ¨¡å¼çš„åˆ‡æ¢éœ€è¦æ—¶é—´ï¼Œæ‰§è¡Œçš„æ“ä½œåœ¨æœªæ¥ä¸€æ®µæ—¶é—´ä¹‹åæ‰ä¼šå°±ç»ªï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å®é™…ç¼–ç¨‹æ—¶æ€»æ˜¯å®¹æ˜“æœ‰â€œç«‹å³ç”Ÿæ•ˆâ€çš„è‚Œè‚‰è®°å¿†ï¼Œè¿™å°±å¯¼è‡´äº†å¹¶å‘é—®é¢˜çš„å¯èƒ½æ€§&lt;/p&gt;
&lt;p&gt;ä¸è¿‡å¯¹äº&lt;strong&gt;å‡½æ•°å¼ç¼–ç¨‹&lt;/strong&gt;è€Œè¨€ï¼Œæ“ä½œä¸å­˜åœ¨å¯¹å¤–çŠ¶æ€çš„ä¿®æ”¹ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ï¼ˆåªä¼šæ“ä½œå±€éƒ¨å˜é‡ï¼‰ï¼Œè¿™å°±ä¸ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜&lt;/p&gt;
&lt;p&gt;Data Race å‘ç”Ÿçš„å®è´¨æ˜¯&lt;strong&gt;ä¸åŒçš„çº¿ç¨‹&lt;/strong&gt;åŒæ—¶è®¿é—®&lt;strong&gt;åŒä¸€å†…å­˜&lt;/strong&gt;ï¼Œå¹¶ä¸”&lt;strong&gt;è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯å†™&lt;/strong&gt;ï¼Œå½¢è±¡çš„ç†è§£å°±æ˜¯ä¸åŒçš„å†…å­˜è®¿é—®åœ¨â€œèµ›è·‘â€ï¼Œè·‘èµ¢çš„æ“ä½œå…ˆæ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Not that easy&lt;/strong&gt;: è™½ç„¶æˆ‘ä»¬å°†æ•°æ®ç«äº‰å½¢è±¡åœ°æ¯”å–»ä¸ºâ€œèµ›è·‘â€ï¼Œä½†å®é™…ä¸Šï¼Œå“ªä¸€ä¸ªæ“ä½œèƒ½â€œè·‘èµ¢â€å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•å’Œç¡®å®šï¼Œå…¶å¤æ‚æ€§ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼±å†…å­˜æ¨¡å‹ (Weak memory model)&lt;/strong&gt;ï¼šåœ¨ç°ä»£å¤„ç†å™¨æ¶æ„ä¸­ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹å†…å­˜æ“ä½œè¿›è¡Œé‡æ’åºã€‚è¿™æ„å‘³ç€ï¼Œä¸åŒçš„çº¿ç¨‹æˆ–â€œè§‚å¯Ÿè€…â€åœ¨ä¸åŒæ—¶é—´ç‚¹çœ‹åˆ°å…±äº«å†…å­˜çš„çŠ¶æ€å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚ä¸€ä¸ªçº¿ç¨‹å¯¹å†…å­˜çš„å†™å…¥æ“ä½œï¼Œå¯èƒ½ä¸ä¼šç«‹å³å¯¹æ‰€æœ‰å…¶ä»–çº¿ç¨‹å¯è§ï¼Œå¯¼è‡´ä¸åŒçº¿ç¨‹è§‚å¯Ÿåˆ°ä¸åŒçš„ç»“æœã€‚è¿™ç§&lt;strong&gt;å†…å­˜æ¨¡å‹çš„ä¸€è‡´æ€§é—®é¢˜&lt;/strong&gt;ä½¿å¾—ç¡®å®šå“ªä¸ªæ“ä½œâ€œå…ˆå‘ç”Ÿâ€å˜å¾—éå¸¸å›°éš¾ä¸”ä¸ç¡®å®šã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æœªå®šä¹‰è¡Œä¸º (Undefined Behavior)&lt;/strong&gt;ï¼šä» C++11 æ ‡å‡†å¼€å§‹ï¼Œæ•°æ®ç«äº‰è¢«æ˜ç¡®è§„å®šä¸º&lt;strong&gt;æœªå®šä¹‰è¡Œä¸º&lt;/strong&gt;ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ çš„ç¨‹åºå‘ç”Ÿäº†æ•°æ®ç«äº‰ï¼Œç¼–è¯‘å™¨å¯ä»¥è‡ªç”±åœ°äº§ç”Ÿä»»ä½•è¡Œä¸ºï¼Œæ— è®ºæ˜¯å´©æºƒã€äº§ç”Ÿé”™è¯¯ç»“æœï¼Œè¿˜æ˜¯çœ‹ä¼¼æ­£å¸¸è¿è¡Œä½†ç»“æœä¸å¯é¢„æµ‹ã€‚è¿™ä½¿å¾—æ•°æ®ç«äº‰æˆä¸ºéå¸¸å±é™©ä¸”éš¾ä»¥è°ƒè¯•çš„å¹¶å‘é”™è¯¯ï¼Œå› ä¸ºå®ƒçš„è¡¨ç°å¯èƒ½æ˜¯ä¸ç¡®å®šã€ä¸ç¨³å®šçš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¤šçº¿ç¨‹ä¸å¤šå†…å­˜çš„å¤æ‚äº¤äº’&lt;/strong&gt;ï¼šåœ¨å®é™…çš„å¹¶å‘ç¨‹åºä¸­ï¼Œé€šå¸¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å¤šä¸ªå…±äº«å†…å­˜ä½ç½®ã€‚è¿™äº›çº¿ç¨‹å’Œå†…å­˜ä¹‹é—´å­˜åœ¨å¤æ‚çš„è¯»ï¼ˆRï¼‰å†™ï¼ˆWï¼‰äº¤äº’ã€‚ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå†…å­˜ä½ç½®çš„å†™å…¥å¯èƒ½å½±å“åˆ°å…¶ä»–å¤šä¸ªçº¿ç¨‹å¯¹è¯¥ä½ç½®çš„è¯»å–ï¼ŒåŒæ—¶ï¼Œå¤šä¸ªå†…å­˜ä½ç½®ä¹‹é—´ä¹Ÿå¯èƒ½å­˜åœ¨å¤æ‚çš„ä¾èµ–å…³ç³»å’Œç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚è¿™ç§é”™ç»¼å¤æ‚çš„äº¤äº’ç½‘ç»œè¿›ä¸€æ­¥åŠ å‰§äº†æ•°æ®ç«äº‰çš„ä¸å¯é¢„æµ‹æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†æ¶ˆç­æ•°æ®ç«äº‰ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ç¨‹åºçš„ serializability ï¼Œ&lt;strong&gt;å¯èƒ½ç«äº‰çš„å†…å­˜è®¿é—®è¦ä¹ˆäº’æ–¥ï¼Œè¦ä¹ˆåŒæ­¥&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®é™…ç¼–ç¨‹ä¸­é‡åˆ°çš„æ•°æ®ç«äº‰ bug å¤§å¤šå±äº&lt;strong&gt;ä¸Šé”™äº†é”&lt;/strong&gt;å’Œ&lt;strong&gt;å¿˜è®°ä¸Šé”&lt;/strong&gt;ä¸¤ç§æƒ…å†µçš„å˜ç§&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Case 1: ä¸Šé”™äº†é”&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;T_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;spin_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;spin_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;T_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;spin_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;spin_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Case 2: å¿˜è®°ä¸Šé”&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;T_1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;spin_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;spin_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;T_2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;ä½†æ˜¯å®é™…ç³»ç»Ÿé¢ä¸´çš„æƒ…å†µæ¯”è¿™å¤æ‚çš„å¤šï¼Œå› ä¸º&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å†…å­˜å¯ä»¥æ˜¯åœ°å€ç©ºé—´çš„ä»»ä½•å†…å­˜ï¼Œæ¯”å¦‚å…¨å±€å˜é‡ã€å †å†…å­˜åˆ†é…çš„å˜é‡ã€ç¨‹åºçš„æ ˆâ€¦â€¦&lt;/li&gt;
&lt;li&gt;è®¿é—®å¯ä»¥å‘ç”Ÿåœ¨ä»»ä½•ä»£ç ï¼Œæ¯”å¦‚è‡ªå·±çš„ä»£ç ã€æ¡†æ¶ä»£ç ã€ä¸€è¡Œæ²¡è¯»åˆ°çš„æ±‡ç¼–æŒ‡ä»¤ã€æŸæ¡ ret æŒ‡ä»¤
&lt;ul&gt;
&lt;li&gt;â€œä¸€è¡Œæ²¡è¯»åˆ°çš„æ±‡ç¼–æŒ‡ä»¤â€é€ æˆçš„è®¿é—®çš„æƒ…å†µæœ‰ç¼–è¯‘å™¨ä¼˜åŒ–é€ æˆçš„æŒ‡ä»¤é‡æ’ã€ç¡¬ä»¶å±‚é¢å¼±å†…å­˜æ¨¡å‹çš„å†…å­˜è®¿é—®é‡æ’ã€è¿˜æœ‰ä¸€äº›é«˜å±‚è¯­è¨€æ“ä½œçš„éšå¼å†…å­˜è®¿é—®&lt;/li&gt;
&lt;li&gt;å®é™…ç³»ç»Ÿä¸­è™½ç„¶éš¾ä»¥é¿å…ï¼Œä½†æ˜¯ä¼šå°½å¯èƒ½ä¿è¯åº•å±‚çš„ç»“æ„å¯¹ä¸Šå±‚å°½å¯èƒ½å°é—­æ¥é˜²æ­¢è¿™ç§é”™è¯¯&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ­»é”&#34;&gt;æ­»é”&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ­»é” (Deadlock)&lt;/strong&gt; æ˜¯æŒ‡ä¸€ä¸ªç¾¤ä½“ä¸­çš„æ¯ä¸ªæˆå‘˜éƒ½åœ¨ç­‰å¾…å…¶ä»–æˆå‘˜ï¼ˆåŒ…æ‹¬è‡ªèº«ï¼‰é‡‡å–è¡ŒåŠ¨çš„çŠ¶æ€&lt;/p&gt;
&lt;p&gt;æ­»é”æœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AA-Deadlock&lt;/strong&gt;: è‡ªå·±ç­‰å¾…è‡ªå·±&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// lk-&amp;gt;locked == âœ…; proceed
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Possibly in interrupt handler
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// while (lk-&amp;gt;locked == âŒ) ;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™æ ·çš„é”™è¯¯è™½ç„¶çœ‹èµ·æ¥å¾ˆå‚»ï¼Œä½†æ˜¯åœ¨çœŸå®ç¨‹åºå¤æ‚çš„æ§åˆ¶æµä¸­æ˜¯å¯èƒ½å‡ºç°çš„&lt;/p&gt;</description>
    </item>
    <item>
      <title>16. å¹¶å‘æ§åˆ¶ï¼šåŒæ­¥ä¿¡å·é‡</title>
      <link>https://diefish1024.github.io/posts/nju-os-2025/16-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%E5%90%8C%E6%AD%A5%E4%BF%A1%E5%8F%B7%E9%87%8F/</link>
      <pubDate>Mon, 21 Jul 2025 14:56:00 +0800</pubDate>
      <guid>https://diefish1024.github.io/posts/nju-os-2025/16-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%E5%90%8C%E6%AD%A5%E4%BF%A1%E5%8F%B7%E9%87%8F/</guid>
      <description>&lt;h2 id=&#34;ä¿¡å·é‡&#34;&gt;ä¿¡å·é‡&lt;/h2&gt;
&lt;p&gt;äº’æ–¥é”åœ¨æŸç§æ„ä¹‰ä¸Šä¹Ÿå¯ä»¥è®¤ä¸ºå®ç°äº† &amp;ldquo;happens-before&amp;rdquo; çš„ä¾èµ–å…³ç³»â€”â€” release å¿…ç„¶å‘ç”Ÿåœ¨ acquire ä¹‹å‰ã€‚æˆ‘ä»¬å¯ä»¥è¯•ç€åˆ©ç”¨è¿™ç§ä¾èµ–å…³ç³»æ¥å®ç°è®¡ç®—å›¾çš„è°ƒåº¦ï¼šä¸ºæ¯æ¡è¾¹åˆ†é…ä¸€ä¸ªäº’æ–¥é”ï¼Œä»£è¡¨æ•°æ®æˆ–å‰ç½®ä»»åŠ¡çš„å®Œæˆï¼›ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»è·å¾—æ‰€æœ‰å…¥è¾¹å¯¹åº”çš„äº’æ–¥é”æ‰èƒ½å¼€å§‹è®¡ç®—ï¼Œè®¡ç®—å®Œæˆåï¼Œå°±é‡Šæ”¾æ‰€æœ‰å‡ºè¾¹å¯¹åº”çš„äº’æ–¥é”ï¼Œé€šçŸ¥ä¸‹æ¸¸èŠ‚ç‚¹è¾“å‡ºå°±ç»ªï¼ˆä½†æ˜¯è¿™ç§ç›´æ¥ä½¿ç”¨äº’æ–¥é”ä½œä¸ºè¾¹çŠ¶æ€ä¿¡å·çš„æ–¹å¼æ˜¯ undefined behaviorï¼Œå› ä¸ºäº’æ–¥é”ä¸»è¦ç”¨äºä¿æŠ¤ä¸´ç•ŒåŒºï¼Œå…¶é‡Šæ”¾é€šå¸¸è¦æ±‚ç”±æŒæœ‰å®ƒçš„çº¿ç¨‹å®Œæˆï¼Œè‹¥é‡Šæ”¾æœªæ›¾è·å–çš„é”ï¼Œåˆ™è¡Œä¸ºæœªå®šä¹‰ï¼‰&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä»è¿™ç§æƒ³æ³•ä¸­æŠ½è±¡å‡ºå…¶æœ¬è´¨ï¼Œä¹Ÿå°±æ˜¯ç”¨ä¸€ä¸ªâ€œ&lt;strong&gt;ä¿¡å·&lt;/strong&gt;â€å»è·å–èµ„æºçš„è®¸å¯ï¼Œç±»ä¼¼é¤å…çš„å–å·åƒé¥­&lt;/p&gt;
&lt;p&gt;è¿™ç§&lt;strong&gt;ä¿¡å·&lt;/strong&gt;çš„æ€æƒ³å¾ˆé€‚åˆç”¨æ¥ç®¡ç†&lt;strong&gt;è®¡æ•°ç±»å‹çš„åŒç±»èµ„æº&lt;/strong&gt;ï¼Œæ¯”å¦‚åœè½¦åœºçš„ç©ºä½ï¼Œä¸ºäº†å®ç°è¿™ç§ producer-customer çš„é—®é¢˜ï¼Œç”¨ &lt;a href=&#34;15.%20%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%EF%BC%9A%E5%90%8C%E6%AD%A5%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F.md&#34;&gt;æ¡ä»¶å˜é‡&lt;/a&gt; å¯ä»¥è½»æ˜“è§£å†³ï¼Œè¿›å…¥çš„æ¡ä»¶å°±æ˜¯å­˜åœ¨ç©ºä½ &lt;code&gt;count &amp;lt; capacity&lt;/code&gt; ï¼Œé‚£æˆ‘ä»¬ä»å‡å°‘å˜é‡çš„è§’åº¦å‡ºå‘ï¼Œè¿™å®é™…ä¸Šä¹Ÿå°±æ˜¯å‰©ä½™ç©ºä½çš„æ•°é‡å¤§äºé›¶ï¼Œæˆ‘ä»¬åœè½¦ç›¸å½“äº&lt;strong&gt;æ¶ˆè€—&lt;/strong&gt;äº†ä¸€ä¸ªè½¦ä½ï¼Œç¦»å¼€ç›¸å½“äº&lt;strong&gt;åˆ›é€ &lt;/strong&gt;äº†ä¸€ä¸ªè½¦ä½ï¼Œè¿™ä¹Ÿå°±å¾—åˆ°äº†æ‰€è°“â€œ&lt;strong&gt;ä¿¡å·é‡&lt;/strong&gt;â€çš„æœºåˆ¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;P&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;sem_t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Prolaag - try + decrease/down/wait/acquire
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;mutex_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nf&#34;&gt;cond_wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// æ¶ˆè€—ä¸€ä¸ªä¿¡å· (è½¦ä½)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;mutex_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;V&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;sem_t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Verhoog - increase/up/post/signal/release
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;mutex_lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºä¸€ä¸ªä¿¡å· (è½¦ä½)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;nf&#34;&gt;cond_broadcast&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nf&#34;&gt;mutex_unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sem&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ ¹æ®è¿™ä¸ªä¸€è·¯æ¨å‡ºä¿¡å·é‡çš„æ€è·¯ï¼Œæˆ–è®¸å¯ä»¥è®¤ä¸ºè¿™æ˜¯äº’æ–¥é”çš„æ‰©å±•&lt;/p&gt;</description>
    </item>
    <item>
      <title>15. å¹¶å‘æ§åˆ¶ï¼šåŒæ­¥æ¡ä»¶å˜é‡</title>
      <link>https://diefish1024.github.io/posts/nju-os-2025/15-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%E5%90%8C%E6%AD%A5%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F/</link>
      <pubDate>Mon, 21 Jul 2025 14:55:00 +0800</pubDate>
      <guid>https://diefish1024.github.io/posts/nju-os-2025/15-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%E5%90%8C%E6%AD%A5%E6%9D%A1%E4%BB%B6%E5%8F%98%E9%87%8F/</guid>
      <description>&lt;h2 id=&#34;åŒæ­¥å’Œæ¡ä»¶å˜é‡&#34;&gt;åŒæ­¥å’Œæ¡ä»¶å˜é‡&lt;/h2&gt;
&lt;p&gt;äº’æ–¥å®ç°äº†&lt;strong&gt;åŸå­æ€§&lt;/strong&gt;ï¼Œä½†æ˜¯æ— æ³•å®ç°&lt;strong&gt;ç¡®å®šæ€§&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯æ— æ³•æ­£ç¡®å®ç° &amp;ldquo;happens-before&amp;rdquo; çš„å…³ç³»&lt;/p&gt;
&lt;p&gt;å› æ­¤éœ€è¦å¼•å…¥æ¡ä»¶å˜é‡æ¥å®ç°çº¿ç¨‹çš„åŒæ­¥ï¼Œå½¢æˆå—æ§åˆ¶çš„å¹¶å‘äº‹ä»¶çš„&lt;strong&gt;å‘ç”Ÿé¡ºåº&lt;/strong&gt;ï¼ˆå¯ä»¥ç”¨ä¹å›¢æŒ‡æŒ¥æ¥ç±»æ¯”ï¼‰ï¼ŒæŠŠä¸€ç³»åˆ—ä¸ç¡®å®šçš„çŠ¶æ€åœ¨æŸä¸€ä¸ªæ—¶é—´ç‚¹åŒæ­¥åˆ°äº†ä¸€ä¸ªç¡®å®šçš„çŠ¶æ€ï¼Œå°†å‘æ•£çš„å¹¶å‘ç¨‹åºçŠ¶æ€ â€œæ”¶æŸâ€&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®ç°åŒæ­¥&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®ç° $ A\to B $ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-gdscript3&#34; data-lang=&#34;gdscript3&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;A&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;can_proceed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;signal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;can_proceed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;//&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;B&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wait&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;until&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;condition&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;satisfied&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™æ ·çš„æ€è·¯å¤§è‡´æ­£ç¡®ï¼Œä½†æ˜¯è‡ªé€‰çš„å¾ªç¯æœ‰å¾ˆå¤§çš„æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ›´åŠ åº•å±‚çš„æœºåˆ¶æ¥å¸®åŠ©å®ç°è¿™ä¸€ç‚¹&lt;/p&gt;
&lt;p&gt;æœ€ç†æƒ³çš„ API æ˜¯ &lt;code&gt;wait_until(cond)&lt;/code&gt; ï¼Œä½†æ˜¯è¿‡å»ä¸ºäº†ç®€åŒ–è®¾è®¡ï¼Œå˜æˆäº†&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¡ä»¶ä¸æ»¡è¶³æ—¶ç­‰å¾…ï¼š&lt;code&gt;wait&lt;/code&gt; - ç›´æ¥ç¡çœ ç­‰å¾…&lt;/li&gt;
&lt;li&gt;æ¡ä»¶æ»¡è¶³æ—¶ç»§ç»­ï¼š&lt;code&gt;signal/broadcast&lt;/code&gt; - å”¤é†’æ‰€æœ‰çº¿ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ï¼ˆå°æ—¶å€™çš„ scratch ç¼–ç¨‹å…¶å®å·²ç»æœ‰äº†è¿™æ ·çš„æ€æƒ³ğŸ˜‚ï¼‰&lt;/p&gt;
&lt;p&gt;åœ¨ c++ ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥æŠŠæ¡ä»¶æ”¾åˆ° $ \lambda $ è¡¨è¾¾å¼ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c++&#34; data-lang=&#34;c++&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mutex&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;condition_variable&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;T_player&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;n&#34;&gt;std&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unique_lock&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mtx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;n&#34;&gt;cv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;		&lt;span class=&#34;p&#34;&gt;[]{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;can_proceed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;n&#34;&gt;cv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;notify_all&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;	&lt;span class=&#34;n&#34;&gt;lk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unlock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ³¨æ„æ¡ä»¶å˜é‡åœ¨ç­‰å¾…æ—¶éœ€è¦å¸¦ç€ä¸€æŠŠé”ï¼ˆéœ€è¦ç¡®ä¿æ£€æŸ¥å’Œç­‰å¾…æ˜¯åŸå­æ“ä½œï¼‰&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
